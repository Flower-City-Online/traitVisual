<div #tooltip class="tooltip"></div>

<div class="app-wrapper">
  <canvas #rendererCanvas></canvas>

  <aside class="sidebar">
    <div class="visibility-panel" *ngIf="cluster?.nodes">
      <h3>Toggle Sphere Visibility</h3>
      <div class="checkbox-grid">
        <div
          *ngFor="let node of cluster.nodes; let i = index"
          class="checkbox-list"
        >
          <label>
            <input
              type="checkbox"
              style="margin-right: 8px"
              [checked]="node.mesh.visible"
              (change)="onVisibilityChange($event, node)"
            />
            {{ node.userData["name"] || "Node " + (i + 1) }}
          </label>
        </div>
      </div>
    </div>

    <div class="dropdown-wrapper">
      <label for="central-dropdown" class="label">Central Node</label>
      <select
        #dropdown
        (change)="onDropdownChange($event)"
        class="dropdown central-dropdown"
      >
        <option *ngFor="let node of cluster?.nodes; let i = index" [value]="i">
          {{ node.userData["name"] || "Node " + (i + 1) }}
        </option>
      </select>

      <!-- New Preferences Panel for the Central Node -->
      <div class="preferences-panel" *ngIf="currentCentral">
        <h3>
          Edit Preferences for {{ currentCentral.userData["name"] }} (Central)
        </h3>
        <div
          *ngFor="
            let pref of currentCentral.preferences;
            let i = index;
            trackBy: trackByIndex
          "
          class="attribute-list"
        >
          <label>
            Preference {{ i + 1 }}:
            <input
              type="range"
              min="0"
              max="100"
              [(ngModel)]="currentCentral.preferences[i]"
              (ngModelChange)="onPreferenceChange(i, $event)"
            />
            <span>{{ currentCentral.preferences[i] }}</span>
          </label>
        </div>
      </div>

      <!-- Attribute Editing Dropdown: excludes the central node -->
      <label for="attr-dropdown" class="label">
        Select Node To Edit Attribute
      </label>
      <select
        #attrDropdown
        (change)="onAttrDropdownChange($event)"
        class="dropdown attr-dropdown"
      >
        <option
          *ngFor="let node of nonCentralNodes"
          [value]="node.userData['id']"
        >
          {{ node.userData["name"] || "Node " + node.userData["id"] }}
        </option>
      </select>
    </div>

    <!-- Single Attributes Panel: shows attributes for the node selected in the attribute dropdown,
         falling back to the central node if none is selected -->
    <div class="attributes-panel" *ngIf="editableNode">
      <h3>Adjust Attributes for {{ editableNode.userData["name"] }}</h3>
      <div
        *ngFor="
          let attr of editableNode.attributes;
          let i = index;
          trackBy: trackByIndex
        "
        class="attribute-list"
      >
        <label>
          Attribute {{ i + 1 }}:
          <input
            type="range"
            min="0"
            max="100"
            [(ngModel)]="editableNode.attributes[i]"
            (ngModelChange)="onAttributeChange(i, $event)"
          />
          <span>{{ editableNode.attributes[i] }}</span>
        </label>
      </div>
    </div>

    <!-- New Checkbox for Node Count Toggle -->
    <!-- <div class="checkbox-wrapper">
      <label for="toggle-nodes" class="label">Boom</label>
      <input
        type="checkbox"
        id="toggle-nodes"
        [(ngModel)]="increaseNodes"
        (change)="onNodesToggle($event)"
      />
    </div> -->
  </aside>
</div>
